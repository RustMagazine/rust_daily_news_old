# Rust Quiz 解读：Quiz 3

### Quiz 3: 

下面这段代码输出什么？


```rust
struct S {
    x: i32,
}

const S: S = S { x: 2 };

fn main() {
    let v = &mut S;
    v.x += 1;
    S.x += 1;
    print!("{}{}", v.x, S.x);
}
```

**输出结果： 32**


### 解读：

考察要点： 

1. 可变引用
2. 结构体实例化不需要构造函数
3. const语义

代码中定义了一个具名结构体`S`，包含了一个字段`x`。接下来又定义了一个`const`常量，同样命名为`S`，并且将一个结构体`S`的实例赋值给它。

要注意区分这两个`S`。常量`S`，是代表值，而结构体`S`，则代表类型。在Rust中，分别将这两个S，存储在`值命名空间(Value NameSpace)`和`类型命名空间(Type NameSpace)`中，所以可以同时存在两个相同的S。

常量S，会内联到用它的具体使用的地方。在语义层面，就是表示它的值会替换到使用它的每个地方。

**在main函数中， 常量S会被内联到两个地方：**

**第一个地方**是： `let v = &mut S;`， 这里的S，是一个值，要被const S替换掉。等价于:

```rust
let mut _tmp = S {x: 2} ; 
let v = &mut tmp_;
```

所以，当执行 `v.x += 1` 之后，`v.x`的值就是：3。

**第二个地方**是：`S.x += 1;`，这里的S同样会被替换为const S的值。等价于:

```rust
S {x: 2}.x += 1;
```

而此时，这个S {: 2}是一个新的结构体实例，和上面的S已经无关，所以改变它的值，并不影响到`S.x`的值，所以结果是: 2。

[点此查看Rust Quiz 3](https://dtolnay.github.io/rust-quiz/3)